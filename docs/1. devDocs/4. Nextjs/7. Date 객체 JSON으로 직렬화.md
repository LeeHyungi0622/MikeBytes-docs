# 7.Date ê°ì²´ JSONìœ¼ë¡œ ì§ë ¬í™”(Serialization)

ì´ ì˜¤ë¥˜ëŠ” **Next.jsì˜ `getStaticProps`ì—ì„œ `Date` ê°ì²´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ë°œìƒ**í•©ë‹ˆë‹¤.

### **ì˜¤ë¥˜ ì›ì¸**

`getStaticProps`ëŠ” **JSONìœ¼ë¡œ ì§ë ¬í™”(serialize) ê°€ëŠ¥í•œ ë°ì´í„°ë§Œ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤**.  
ê·¸ëŸ¬ë‚˜ `new Date()` ê°™ì€ **`Date` ê°ì²´ëŠ” JSONìœ¼ë¡œ ë³€í™˜ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì§ë ¬í™” ì˜¤ë¥˜ê°€ ë°œìƒ**í•©ë‹ˆë‹¤.

---

### **í•´ê²° ë°©ë²•(1)**

**1. `Date`ë¥¼ `ISOString` ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜**

```tsx
export async function getStaticProps() {
  const todos = [
    { id: 1, text: "Learn Next.js", createdAt: new Date().toISOString() },
  ];

  return {
    props: { todos },
  };
}
```

**ë³€ê²½ëœ ë‚´ìš©**

- `new Date()` â†’ `new Date().toISOString()` **(ISO í˜•ì‹ì˜ ë¬¸ìì—´ë¡œ ë³€í™˜)**

---

**2. í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ `Date` ê°ì²´ë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©**

```tsx
function TodoList({ todos }) {
  return (
    <ul>
      {todos.map((todo) => (
        <li key={todo.id}>
          {todo.text} - {new Date(todo.createdAt).toLocaleString()}
        </li>
      ))}
    </ul>
  );
}
```

**ë³€ê²½ëœ ë‚´ìš©**

- `new Date(todo.createdAt)` **ì„ ì‚¬ìš©í•´ ë¬¸ìì—´ì„ ë‹¤ì‹œ `Date` ê°ì²´ë¡œ ë³€í™˜**

---

### **ì¶”ê°€ì ì¸ í•´ê²° ë°©ë²•**

#### **3. `next.config.js`ì—ì„œ `date`ë¥¼ ì§ë ¬í™” ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •**

Next.js `13.1.1` ì´í›„ë¶€í„° ê°€ëŠ¥

```js
module.exports = {
  experimental: {
    outputFileTracingIgnores: ["**/*.json"],
    // Date ì§ë ¬í™” í—ˆìš©
    enableUndici: true,
  },
};
```

í•˜ì§€ë§Œ **ê·¼ë³¸ì ì¸ í•´ê²°ì±…ì€ `ISOString` ë³€í™˜ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

**ì¦‰, `Date`ë¥¼ `ISOString`ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ê°€ì¥ ê°„ë‹¨í•˜ê³  ì•ˆì •ì ì¸ í•´ê²°ì±…ì…ë‹ˆë‹¤!**

## Prisma ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ DBì—ì„œ ë°ì´í„° ì¡°íšŒì‹œ ì—ëŸ¬ ë°œìƒ

`prisma.todo.findMany()`ê°€ ë°˜í™˜í•˜ëŠ” ë°ì´í„° ì¤‘ `createdAt` í•„ë“œê°€ **`Date` ê°ì²´**ì´ê¸° ë•Œë¬¸ì— Next.jsì˜ `getStaticProps`ì—ì„œ **JSON ì§ë ¬í™” ì˜¤ë¥˜**ê°€ ë°œìƒí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

---

## **í•´ê²° ë°©ë²•**

### **1. `Date`ë¥¼ `ISOString` ë¬¸ìì—´ë¡œ ë³€í™˜ (ê°€ì¥ ì‰¬ìš´ ë°©ë²•)**

Prismaì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ `map`ì„ ì‚¬ìš©í•´ `createdAt`ì„ ë³€í™˜í•˜ë©´ ë©ë‹ˆë‹¤.

```tsx
export async function getStaticProps() {
  const todos = await prisma.todo.findMany();

  // createdAtì„ ë¬¸ìì—´ë¡œ ë³€í™˜
  const serializedTodos = todos.map((todo) => ({
    ...todo,
    createdAt: todo.createdAt.toISOString(),
  }));

  return { props: { todos: serializedTodos }, revalidate: 10 }; // ISR ì ìš©
}
```

**ë³€ê²½ ì‚¬í•­**

- `createdAt: todo.createdAt.toISOString()`  
  â†’ **Date ê°ì²´ë¥¼ JSON ì§ë ¬í™” ê°€ëŠ¥í•œ ISO 8601 í˜•ì‹ì˜ ë¬¸ìì—´ë¡œ ë³€í™˜**

---

### **2. Prismaì˜ `transform` ì˜µì…˜ ì‚¬ìš© (Prisma v4 ì´ìƒ)**

Prismaì—ì„œ ì§ì ‘ JSON ì§ë ¬í™”ê°€ ê°€ëŠ¥í•œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.

```tsx
export async function getStaticProps() {
  const todos = await prisma.todo.findMany({
    select: {
      id: true,
      text: true,
      createdAt: true,
    },
  });

  return {
    props: {
      todos: JSON.parse(JSON.stringify(todos)), // JSON ë³€í™˜
    },
    revalidate: 10,
  };
}
```

**ë³€ê²½ ì‚¬í•­**

- `JSON.parse(JSON.stringify(todos))`  
  â†’ Prismaì˜ `Date` ê°ì²´ë¥¼ JSON ì§ë ¬í™” ê°€ëŠ¥í•œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜

**ğŸ“¢ í•˜ì§€ë§Œ!** ì´ ë°©ë²•ì€ ì„±ëŠ¥ìƒ ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, **1ë²ˆ ë°©ë²•(`.toISOString()`)ì„ ì¶”ì²œ**í•©ë‹ˆë‹¤.

---

### **3. getServerSideProps ì‚¬ìš© (SSR)**

**ISRì´ í•„ìš” ì—†ë‹¤ë©´ `getServerSideProps`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥**í•©ë‹ˆë‹¤.

```tsx
export async function getServerSideProps() {
  const todos = await prisma.todo.findMany();

  const serializedTodos = todos.map((todo) => ({
    ...todo,
    createdAt: todo.createdAt.toISOString(),
  }));

  return { props: { todos: serializedTodos } };
}
```

ğŸ“Œ **SSRì„ ì‚¬ìš©í•˜ë©´ JSON ì§ë ¬í™” ë¬¸ì œ ì—†ì´ ë°ì´í„°ë¥¼ ë°”ë¡œ ë Œë”ë§ ê°€ëŠ¥**

---

## ğŸš€ **ê²°ë¡ **

âœ… **ISRì„ ìœ ì§€í•˜ë©´ì„œ í•´ê²°í•˜ë ¤ë©´?** â†’ **1ë²ˆ ë°©ë²• (`.toISOString()`)** ì‚¬ìš©  
âœ… **SSRì´ ê°€ëŠ¥í•˜ë©´?** â†’ `getServerSideProps` ì‚¬ìš©

ğŸ’¡ **ì¶”ì²œí•˜ëŠ” ë°©ë²•:**

```tsx
export async function getStaticProps() {
  const todos = await prisma.todo.findMany();
  const serializedTodos = todos.map((todo) => ({
    ...todo,
    createdAt: todo.createdAt.toISOString(),
  }));
  return { props: { todos: serializedTodos }, revalidate: 10 };
}
```

ì´ë ‡ê²Œ í•˜ë©´ **JSON ì§ë ¬í™” ì˜¤ë¥˜ ì—†ì´ ISRë„ ì •ìƒ ì‘ë™**í•©ë‹ˆë‹¤! ğŸš€
